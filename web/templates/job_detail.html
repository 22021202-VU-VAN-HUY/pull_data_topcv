{% extends "base.html" %}
{% block content %}
  <div class="detail-layout">
    <!-- LEFT: HEADER + SECTIONS -->
    <section class="detail-main">
      <!-- HEADER -->
      <div class="base-card detail-card detail-header">
        <div class="detail-company">{{ job.company }}</div>
        <h1 class="detail-title">
          {{ job.title }}
        </h1>

        <button
          type="button"
          class="home-bookmark-button detail-bookmark {{ 'bookmark-starred' if is_starred else 'bookmark-unstarred' }}"
          data-job-id="{{ job.job_id }}"
          aria-label="Đánh dấu công việc"
        >
          ★
        </button>

        <div class="detail-meta">
          <div><strong>Lương:</strong> {{ salary_text or 'Thoả thuận' }}</div>
          <div>
            <strong>Địa điểm:</strong> {{ job.city or '—' }}
          </div>
          <div>
            <strong>Nguồn:</strong> 
            <a href="{{ job.url }}" style="color: blue;" target="_blank">
            TopCV
            </a>
          </div>
          {% if deadline_text %}
            <div class="detail-deadline">
              {{ deadline_text }}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- SECTIONS GIỐNG TOPCV -->
      <div class="base-card detail-card detail-content">
        {% if detail_sections and detail_sections|length > 0 %}
          {% for sec in detail_sections %}
            <div class="detail-section">
              <h2 class="detail-section-title">
                {{ sec.label }}
              </h2>

              {% if sec.html %}
                <div class="detail-section-body detail-section-body-prose">
                  {{ sec.html | safe }}
                </div>
              {% elif sec.text %}
                <div class="detail-section-body detail-section-body-plain">
                  {{ sec.text }}
                </div>
              {% endif %}
            </div>
          {% endfor %}
        {% elif fallback_description %}
          <h2 class="detail-section-title">
            Mô tả chi tiết
          </h2>
          <div
            id="job-desc-plain"
            class="detail-section-body"
            data-raw="{{ fallback_description | e }}"
          ></div>
          <script>
            document.addEventListener('DOMContentLoaded', function () {
              var el = document.getElementById('job-desc-plain');
              if (!el) return;
              var raw = el.getAttribute('data-raw') || '';
              if (window.formatChatMarkup) {
                el.innerHTML = window.formatChatMarkup(raw);
              } else {
                el.textContent = raw;
              }
            });
          </script>
        {% else %}
          <p class="detail-section-body">
            Không có mô tả chi tiết cho công việc này.
          </p>
        {% endif %}
      </div>
    </section>

    <!-- RIGHT: THÔNG TIN THÊM -->
    <aside class="detail-sidebar">
      <div class="base-card detail-sidebar-card">
        <!--<h3 class="detail-sidebar-title text-xs font-semibold text-gray-500 mb-3">
          Thông tin thêm
        </h3>-->

        <!-- Thông tin công ty -->
        <div class="mb-4">
          <h2 class="detail-sidebar-heading">
            Thông tin công ty
          </h2>
          <ul class="detail-sidebar-list">
            {% for label, value in company_info.items() %}
              {% if value %}
                <li>
                  <strong>{{ label }}:</strong>
                  {% if label == 'Website' %}
                    <a href="{{ value }}" target="_blank" rel="noreferrer" class="base-link text-indigo-600">
                      {{ value }}
                    </a>
                  {% else %}
                    {{ value }}
                  {% endif %}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

        <!-- Thông tin chung -->
        <div class="mb-3">
          <h3 class="detail-sidebar-heading">
            Thông tin chung
          </h3>
          <ul class="detail-sidebar-list">
            {% for label, value in general_info.items() %}
              {% if value %}
                <li>
                  <strong>{{ label }}:</strong> {{ value }}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

        <a href="{{ url_for('jobs.index') }}" class="base-link detail-back-link">
          ← Quay lại danh sách
        </a>
      </div>
    </aside>
  </div>
  <script src="{{ url_for('static', filename='js/job_detail.js') }}"></script>
{% endblock %}
