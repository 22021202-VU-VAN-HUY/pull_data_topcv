{% extends "base.html" %}
{% block content %}
  <div class="detail-layout grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- LEFT: HEADER + SECTIONS -->
    <section class="detail-main lg:col-span-2 space-y-6">
      <!-- HEADER -->
      <div class="base-card detail-header bg-white p-6 relative">
        <div class="detail-company text-sm text-gray-500">{{ job.company }}</div>
        <h1 class="detail-title text-2xl font-bold mt-1 text-gray-900">
          {{ job.title }}
        </h1>

        <button
          type="button"
          class="home-bookmark-button detail-bookmark absolute top-4 right-4 text-2xl {{ 'text-yellow-400' if is_starred else 'text-gray-300' }}"
          data-job-id="{{ job.job_id }}"
          aria-label="Đánh dấu công việc"
        >
          ★
        </button>

        <div class="detail-meta mt-3 text-sm text-gray-700 space-y-1">
          <div><strong>Lương:</strong> {{ salary_text or 'Thoả thuận' }}</div>
          <div>
            <strong>Địa điểm:</strong> {{ job.city or '—' }}
          </div>
          <div>
            <strong>Nguồn:</strong> 
            <a href="{{ job.url }}" style="color: blue;" target="_blank">
            TopCV
            </a>
          </div>
          {% if deadline_text %}
            <div class="detail-deadline text-xs text-gray-600">
              {{ deadline_text }}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- SECTIONS GIỐNG TOPCV -->
      <div class="base-card detail-content bg-white p-6">
        {% if detail_sections and detail_sections|length > 0 %}
          {% for sec in detail_sections %}
            <div class="detail-section mb-6">
              <h2 class="detail-section-title text-base font-semibold mb-2">
                {{ sec.label }}
              </h2>

              {% if sec.html %}
                <div class="detail-section-body text-sm text-gray-800 prose max-w-none">
                  {{ sec.html | safe }}
                </div>
              {% elif sec.text %}
                <div class="detail-section-body text-sm text-gray-800 whitespace-pre-line">
                  {{ sec.text }}
                </div>
              {% endif %}
            </div>
          {% endfor %}
        {% elif fallback_description %}
          <h2 class="detail-section-title text-base font-semibold mb-2">
            Mô tả chi tiết
          </h2>
          <div
            id="job-desc-plain"
            class="detail-section-body text-sm text-gray-800"
            data-raw="{{ fallback_description | e }}"
          ></div>
          <script>
            document.addEventListener('DOMContentLoaded', function () {
              var el = document.getElementById('job-desc-plain');
              if (!el) return;
              var raw = el.getAttribute('data-raw') || '';
              if (window.formatChatMarkup) {
                el.innerHTML = window.formatChatMarkup(raw);
              } else {
                el.textContent = raw;
              }
            });
          </script>
        {% else %}
          <p class="text-sm text-gray-500">
            Không có mô tả chi tiết cho công việc này.
          </p>
        {% endif %}
      </div>
    </section>

    <!-- RIGHT: THÔNG TIN THÊM -->
    <aside class="detail-sidebar lg:col-span-1 space-y-4">
      <div class="base-card bg-white p-5">
        <!--<h3 class="detail-sidebar-title text-xs font-semibold text-gray-500 mb-3">
          Thông tin thêm
        </h3>-->

        <!-- Thông tin công ty -->
        <div class="mb-4">
          <h2 class="text-sm font-semibold text-gray-800 mb-1">
            Thông tin công ty
          </h2>
          <ul class="detail-sidebar-list text-xs text-gray-700 space-y-1">
            {% for label, value in company_info.items() %}
              {% if value %}
                <li>
                  <strong>{{ label }}:</strong>
                  {% if label == 'Website' %}
                    <a href="{{ value }}" target="_blank" rel="noreferrer" class="base-link text-indigo-600">
                      {{ value }}
                    </a>
                  {% else %}
                    {{ value }}
                  {% endif %}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

        <!-- Thông tin chung -->
        <div class="mb-3">
          <h3 class="text-sm font-semibold text-gray-800 mb-1">
            Thông tin chung
          </h3>
          <ul class="detail-sidebar-list text-xs text-gray-700 space-y-1">
            {% for label, value in general_info.items() %}
              {% if value %}
                <li>
                  <strong>{{ label }}:</strong> {{ value }}
                </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

        <a href="{{ url_for('jobs.index') }}" class="base-link text-sm text-indigo-600 inline-block mt-2">
          ← Quay lại danh sách
        </a>
      </div>
    </aside>
  </div>
{% endblock %}
