{% extends "base.html" %}
{% block content %}
  <div class="profile-page max-w-5xl mx-auto space-y-5">
    <header class="profile-header text-center space-y-1">
      <h1 class="text-2xl font-semibold text-gray-900 leading-tight">
        {{ section_title or 'Quản lý tài khoản' }}
      </h1>
    </header>

    {% if current_section == 'bookmarks' %}
      <section class="profile-section base-card bg-white p-5 md:p-6">
        <div class="profile-saved-header flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
          <div>
            <p class="text-sm text-gray-600">Danh sách công việc bạn đánh dấu.</p>
          </div>
          <div class="profile-meta-badge">
            {{ bookmark_total }} công việc
          </div>
        </div>

        {% if saved_jobs and saved_jobs|length > 0 %}
          <div class="profile-saved-grid grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-5">
            {% for j in saved_jobs %}
              <div class="home-job-card-wrapper relative h-full">
                <a
                  class="base-card home-job-card block bg-white p-5 h-full min-h-[180px]"
                  href="{{ url_for('jobs.job_detail', job_id=j.job_id) }}"
                >
                  <div class="home-job-company text-xs text-gray-500">{{ j.company }}</div>
                  <div class="home-job-title font-semibold mt-1 text-base text-gray-900">
                    {{ j.title }}
                  </div>
                  <div class="home-job-location mt-1 text-xs text-gray-600">
                    <span class="font-medium">Địa điểm:</span>
                    <span>{{ j.city or 'Đang cập nhật' }}</span>
                    {% if j.district %} · <span>{{ j.district }}</span>{% endif %}
                  </div>
                  <div class="home-job-salary mt-2 text-sm text-emerald-700 font-medium">
                    Lương: {{ j.salary_text or 'thỏa thuận' }}
                  </div>
                  {% if j.deadline_text %}
                    <div class="home-job-deadline mt-1 text-xs text-gray-500">
                      {{ j.deadline_text }}
                    </div>
                  {% endif %}
                </a>
                <button
                  type="button"
                  class="home-bookmark-button absolute top-3 right-3 text-xl text-yellow-400"
                  data-job-id="{{ j.job_id }}"
                  aria-label="Bỏ lưu công việc"
                >
                  ★
                </button>
              </div>
            {% endfor %}
          </div>

          {% if bookmark_total_pages and bookmark_total_pages > 1 %}
            <div class="profile-pagination mt-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 text-sm">
              <div class="profile-pagination-info">
                Trang {{ bookmark_page }}/{{ bookmark_total_pages }}
              </div>
              <div class="profile-pagination-actions flex items-center gap-2">
                {% if bookmark_page > 1 %}
                  <a
                    class="home-pagination-link px-3 py-1 border rounded"
                    href="{{ url_for('auth.profile_section', section='bookmarks', page=bookmark_page-1) }}"
                  >
                    ← Trước
                  </a>
                {% endif %}
                {% if bookmark_page < bookmark_total_pages %}
                  <a
                    class="home-pagination-link px-3 py-1 border rounded"
                    href="{{ url_for('auth.profile_section', section='bookmarks', page=bookmark_page+1) }}"
                  >
                    Sau →
                  </a>
                {% endif %}
              </div>
            </div>
          {% endif %}
        {% else %}
          <p class="profile-empty text-sm text-gray-600 text-center py-4">
            Bạn chưa lưu công việc nào.
          </p>
        {% endif %}
      </section>

    {% elif current_section == 'info' %}
      <section class="base-card profile-section profile-form-card bg-white p-5 md:p-6">
        <form id="profile-form" class="profile-form space-y-3">
          <div class="profile-field">
            <label class="profile-label block text-sm text-gray-700">Họ và tên</label>
            <input
              id="profile-fullname"
              class="profile-input w-full border rounded px-3 py-2 text-sm"
              type="text"
              value="{{ user.full_name if user else '' }}"
            />
          </div>
          <div class="profile-field">
            <label class="profile-label block text-sm text-gray-700">Email</label>
            <input
              id="profile-email"
              class="profile-input w-full border rounded px-3 py-2 text-sm bg-gray-100"
              type="email"
              value="{{ user.email if user else '' }}"
              disabled
            />
          </div>
          <div class="profile-field">
            <label class="profile-label block text-sm text-gray-700">Số điện thoại</label>
            <input
              id="profile-phone"
              class="profile-input w-full border rounded px-3 py-2 text-sm"
              type="text"
              value="{{ user.phone if user else '' }}"
            />
          </div>
          <button
            id="btn-profile-save"
            type="button"
            class="profile-button-save base-button-primary px-4 py-2 rounded text-sm w-full sm:w-auto"
          >
            Lưu thay đổi
          </button>
          <div id="profile-status" class="profile-status text-xs text-gray-600 mt-1"></div>
        </form>
      </section>

    {% elif current_section == 'password' %}
      <section class="base-card profile-section profile-form-card bg-white p-5 md:p-6">
        <form id="password-form" class="profile-form space-y-3">
          <div class="profile-field">
            <label class="profile-label block text-sm text-gray-700">Mật khẩu hiện tại</label>
            <input
              id="pw-old"
              class="profile-input w-full border rounded px-3 py-2 text-sm"
              type="password"
            />
          </div>
          <div class="profile-field">
            <label class="profile-label block text-sm text-gray-700">Mật khẩu mới</label>
            <input
              id="pw-new"
              class="profile-input w-full border rounded px-3 py-2 text-sm"
              type="password"
            />
          </div>
          <div class="profile-field">
            <label class="profile-label block text-sm text-gray-700">Nhập lại mật khẩu mới</label>
            <input
              id="pw-new2"
              class="profile-input w-full border rounded px-3 py-2 text-sm"
              type="password"
            />
          </div>
          <button
            id="btn-pw-change"
            type="button"
            class="profile-button-save base-button-primary px-4 py-2 rounded text-sm w-full sm:w-auto"
          >
            Đổi mật khẩu
          </button>
          <div id="pw-status" class="profile-status text-xs text-gray-600 mt-1"></div>
        </form>
      </section>
    {% endif %}
  </div>
{% endblock %}
